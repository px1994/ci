# .github/workflows/ci_cd.yml
name: CI/CD Pipeline
on: # [push, pull_request]
  push:
    #branches: [main] # Trigger on pushes to the main branch [push, pull_request]
  #pull_request:
    #branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest # GitHub provides a Linux virtual machine | Clean environment every run (fresh OS)

    steps:
    - name: Checkout repository  # checkout cod to the runner
      uses: actions/checkout@v3 # Downloads your GitHub repository code into the runner | Without this â†’ no code available

    - name: Set up Python 3.10  # setup python environment
      uses: actions/setup-python@v4 # Installs Python 3.10 on the runner | Ensures same Python version as local machine
      with:
        python-version: '3.10'
    - name: Set up CML # setup continuous machine learning
      uses: iterative/setup-cml@v2  # Installs CML on the runner

    - name: Install dependencies # install project dependencies
      run: |
        python -m pip install --upgrade pip   
        pip install -r requirements.txt

    - name: Run main.py
      run: |
        python main.py

    - name: create CML report
      env:
        GITHUB_TOKEN: ${{ secrets.TOKEN }} # to comment on PRs
      run: |
        echo "First line of our CML report" > report.md
        echo "Bar plots generated by main.py:" >> report.md
        echo "![](./bars.png "Bar plot")" >> report.md
        echo "## Line plots" >> report.md
        echo "![](./lines.png "Line plot")" >> report.md

        cml comment create report.md 